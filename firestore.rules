rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check authentication
    function isAuthenticated() {
      return request.auth != null;
    }

    // Helper function to check if the user is the master admin
    function isMasterAdmin() {
      return isAuthenticated() &&
        get(/databases/$(database)/documents/login_roles/$(request.auth.token.email)).data.role == "master_admin";
    }

    // Helper function to check if the user owns the document
    function isResourceOwner(userId) {
      return isAuthenticated() && request.auth.token.email == userId;
    }

    

    // User profile rules
    
    
    
    match /user_profile/{userId} {
      allow read: if isResourceOwner(userId);
      allow write: if isResourceOwner(userId);
    }
    
    

    // User consultancies
    match /user_consultancies/{userId} {
      allow read, write: if isResourceOwner(userId);
    }

    // User interviews
    match /user_interviews/{userId} {
      allow read, write: if isResourceOwner(userId);
    }

    // Hiring rules
    match /hiring/{document=**} {
      allow read: if true;
      allow write: if isAuthenticated();
    }

    // Jobs applied rules
    match /jobsapplied/{userId} {
      allow read, write: if isResourceOwner(userId);
    }

    // Login roles rules
    match /login_roles/{document=**} {
      allow read, write: if false; // Disable access in production
    }

    // Leads
    match /lead/{document} {
      allow read: if true;
      allow write: if true;
    }

    // Assessment rules
    match /assessment/{document=**} {
      allow read: if true;
      allow write: if false; // Prevent writes in production
    }

    // User assessment results
    match /user_assessment_results/{document} {
      allow read, write: if isAuthenticated();
    }
    
    // General rules
    match /{document=**} {
      // Master admin can access all
      allow list : if isMasterAdmin();
      allow read, write: if isMasterAdmin();
    }
    
  }
}